# exp_console.yaml

---

controls:
  top:
    - [sw-vol-harmonics,       lcd-pot-1,            lcd-pot-2,            lcd-pot-3,            lcd-pot-4,            lcd-pot-5     ]
    - [sw-even-odd,                                                                                                                  ]
    - [                  [  pot-1l,  pot-1r ], [  pot-2l,  pot-2r ], [  pot-3l,  pot-3r ], [  pot-4l,  pot-4r ], [  pot-5l,  pot-5r ]]
    - [sw-send-top                                                                                                                   ]
    - [bt-send-top                                                                                                                   ]
    - [sw-calibrate-pots                                                                                                             ]
    - [bt-save-calibration                                                                                                           ]
    - [                  [  led-1l,  led-1r ], [  led-2l,  led-2r ], [  led-3l,  led-3r ], [  led-4l,  led-4r ], [  led-5l,  led-5r ]]
    - [led-new-old,      [bt-no-1l, bt-no-1r], [bt-no-2l, bt-no-2r], [bt-no-3l, bt-no-3r], [bt-no-4l, bt-no-4r], [bt-no-5l, bt-no-5r]]
    - [led-crs-fine,     [sw-course_fine-1  ], [sw-course_fine-2  ], [sw-course_fine-3  ], [sw-course_fine-4  ], [sw-course_fine-5  ]]
    - [led-mult-cents,   [sw-mult-cents-1   ], [sw-mult-cents-2   ], [sw-mult-cents-3   ], [sw-mult-cents-4   ], [sw-mult-cents-5   ]]

  lower-left:
    - [rsw-channel,                             lcd-lower-left-1,        lcd-lower-left-2,       lcd-lower-left-3,  ]
    - [                 sw-inst-synth,  [sw-major-minor,    re-1r  ], [  re-2l,     re-2r  ], [  re-3l,     re-3r  ]]
    - [rsw-function,    led-inst-synth, [led-major-minor, led-re-1r], [led-re-2l, led-re-2r], [led-re-3l, led-re-3r]] 
    - [                 bt-send-lower-left                                                                          ]

  lower-right:
    - [                       pot-lr1,  pot-lr2,  pot-lr3  ]
    - [sw-send-lower-right                                 ]
    - [bt-send-lower-right                                 ]

  notes:
    - [sw-continuous-pulse, sw-A3, sw-C4, sw-E4, sw-G4, sw-Bb4, sw-C5]
    - [                     bt-A3, bt-C4, bt-E4, bt-G4, bt-Bb4, bt-C5]

prefixes:
  sw: Toggle Switch
  bt: Button
  led: LED
  lcd: LCD
  rsw: Rotary Switch
  re: Rotary Encoder
  pot: Slide Pot


devices:
  I/O-sw-1:
    type: I/O Expander Input
    addr: 0x20
    pins:
      - name: A2
        connect: [GND]
      - name: A1
        connect: [GND]
      - name: A0
        connect: [GND]
    fans-out-to:
      - [rsw-channel, fanout-pins]
      - sw-even-odd
      - sw-vol-harmonics
      - sw-send-top
      - bt-send-top

  I/O-sw-2:
    type: I/O Expander Input
    addr: 0x21
    pins:
      - name: A2
        connect: [GND]
      - name: A1
        connect: [GND]
      - name: A0
        connect: [5V]
    fans-out-to:
      - bt-no-1l
      - bt-no-1r
      - bt-no-2l
      - bt-no-2r
      - bt-no-3l
      - bt-no-3r
      - bt-no-4l
      - bt-no-4r
      - bt-no-5l
      - bt-no-5r
      - sw-course_fine-1
      - sw-course_fine-2
      - sw-course_fine-3
      - sw-course_fine-4
      - sw-course_fine-5

  I/O-sw-3:
    type: I/O Expander Input
    addr: 0x22
    pins:
      - name: A2
        connect: [GND]
      - name: A1
        connect: [5V]
      - name: A0
        connect: [GND]
    fans-out-to:
      - [rsw-function, fanout-pins]

  I/O-sw-4:
    type: I/O Expander Input
    addr: 0x23
    pins:
      - name: A2
        connect: [GND]
      - name: A1
        connect: [5V]
      - name: A0
        connect: [5V]
    fans-out-to:
      - [re-1r, fanout-pins]
      - [re-2l, fanout-pins]
      - [re-2r, fanout-pins]
      - [re-3l, fanout-pins]
      - [re-3r, fanout-pins]

  I/O-sw-5:
    type: I/O Expander Input
    addr: 0x24
    pins:
      - name: A2
        connect: [5V]
      - name: A1
        connect: [GND]
      - name: A0
        connect: [GND]
    fans-out-to:
      - sw-mult-cents-1
      - sw-mult-cents-2
      - sw-mult-cents-3
      - sw-mult-cents-4
      - sw-mult-cents-5
      - bt-send-lower-left
      - sw-inst-synth
      - sw-major-minor
      - sw-send-lower-right
      - bt-send-lower-right
      - sw-calibrate-pots
      - bt-save-calibration

  I/O-led-1:
    type: I/O Expander Output
    addr: 0x25
    pins:
      - name: A2
        connect: [5V]
      - name: A1
        connect: [GND]
      - name: A0
        connect: [5V]
    fans-out-to:
      - led-1l
      - led-1r
      - led-2l
      - led-2r
      - led-3l
      - led-3r
      - led-4l
      - led-4r
      - led-5l
      - led-5r

  I/O-led-2:
    type: I/O Expander Output
    addr: 0x26
    pins:
      - name: A2
        connect: [5V]
      - name: A1
        connect: [5V]
      - name: A0
        connect: [GND]
    fans-out-to:
      - led-new-old
      - led-crs-fine
      - led-mult-cents
      - led-inst-synth
      - led-major-minor
      - led-re-1r
      - led-re-2l
      - led-re-2r
      - led-re-3l
      - led-re-3r

  lcd-muxes-1:
    type: [batch, Multiplexer]
    fans-out-to:
      - lcd-pot-1
      - lcd-pot-2
      - lcd-pot-3
      - lcd-pot-4
      - lcd-pot-5
      - lcd-lower-left-1
      - lcd-lower-left-2
      - lcd-lower-left-3
    devices:
      - name: lcd-mux-1-E
        links-pin: E
      - name: lcd-mux-1-DB0
        links-pin: DB0
      - name: lcd-mux-1-DB1
        links-pin: DB1
      - name: lcd-mux-1-DB2
        links-pin: DB2
      - name: lcd-mux-1-DB3
        links-pin: DB3
      - name: lcd-mux-1-DB4
        links-pin: DB4
      - name: lcd-mux-1-DB5
        links-pin: DB5
      - name: lcd-mux-1-DB6
        links-pin: DB6
      - name: lcd-mux-1-DB7
        links-pin: DB7
    batch-common-pins: [A, B, C]
    device-link-pin: X

  pot-mux-1:
    type: Multiplexer
    fans-out-to: [pot-1l,  pot-1r, pot-2l,   pot-2r,   pot-3l,  pot-3r,  pot-4l,  pot-4r]

  pot-mux-2:
    type: Multiplexer
    fans-out-to: [pot-5l,  pot-5r, pot-lr1,  pot-lr2,  pot-lr3]

  master-controller:
    type: nano 33 iot
    i2c_addr: None   # Master...
    pins:
      - name: SDA
      - name: SCL

  level-shifter:
    type: I2C-level-shifter
    pins:
      - name: V1.1
        connect: [[master-controller, SCL]]
      - name: V1.2
        connect: [[master-controller, SDA]]
      - name: V2.1
        connect: [[I/O-sw-1, SCL], [I/O-sw-2, SCL], [I/O-sw-3, SCL], [I/O-sw-4, SCL],
                  [I/O-sw-5, SCL], [I/O-led-1, SCL], [I/O-led-2, SCL]]
      - name: V2.2
        connect: [[I/O-sw-1, SDA], [I/O-sw-2, SDA], [I/O-sw-3, SDA], [I/O-sw-4, SDA],
                  [I/O-sw-5, SDA], [I/O-led-1, SDA], [I/O-led-2, SDA]]

  pot-controller:  # 5 pins for pots, 2 for I2C
    type: nano every
    i2c_addr: 0x31
    pins:
      - name: A0
        connect: [pot-mux-1 X]
      - name: A1
        connect: [pot-mux-2 X]
      - name: A2
        connect: []
      - name: A3
        connect: []
      - name: SDA
        connect: [[master-controller, SDA]]
      - name: SCL
        connect: [[master-controller, SCL]]
      - name: D10
        connect: [[pot-mux-1, B], [pot-mux-2, B]]
      - name: D9
        connect: [[pot-mux-1, A], [pot-mux-2, A]]
      - name: D5
        connect: [[pot-mux-1, C], [pot-mux-2, C]]

  lcd-controller:  # 14 for LCDs, 2 for I2C
    type: nano every
    i2c_addr: 0x32
    pins:
      - name: A0
        connect: [[lcd-mux-1-DB3, X]]
        comment: DB3
      - name: A1
        connect: [[lcd-mux-1-DB2, X]]
        comment: DB2
      - name: A2
        connect: [[lcd-mux-1-DB1, X]]
        comment: DB1
      - name: A3
        connect: [[lcd-mux-1-DB0, X]]
        comment: DB0
      - name: SDA
        connect: [[master-controller, SDA]]
      - name: SCL
        connect: [[master-controller, SCL]]
      - name: A6
        connect: [[lcd-mux-1-DB4, X]]
        comment: DB4
      - name: A7
        connect: [[lcd-mux-1-DB5, X]]
        comment: DB5
      - name: D10
        connect: [[lcd-pot-1, R/W], [lcd-pot-2, R/W], [lcd-pot-3, R/W],
                  [lcd-pot-4, R/W], [lcd-pot-5, R/W], [lcd-lower-left-1, R/W],
                  [lcd-lower-left-2, R/W], [lcd-lower-left-3, R/W]]
        comment: R/W
      - name: D9
        connect: [[lcd-mux-1-E, X]]
        comment: E
      - name: D7
        connect: [[lcd-mux-1-DB7, X]]
        comment: DB7
      - name: D5
        connect: [[lcd-pot-1, RS], [lcd-pot-2, RS], [lcd-pot-3, RS],
                  [lcd-pot-4, RS], [lcd-pot-5, RS], [lcd-lower-left-1, RS],
                  [lcd-lower-left-2, RS], [lcd-lower-left-3, RS]]
        comment: RS
      - name: D4
        connect: [[lcd-mux-1-E, C]]
        comment: C
      - name: D2
        connect: [[lcd-mux-1-DB6, X]]
        comment: DB6
      - name: RX
        connect: [[lcd-mux-1-E, B]]
        comment: B
      - name: TX
        connect: [[lcd-mux-1-E, A]]
        comment: A

